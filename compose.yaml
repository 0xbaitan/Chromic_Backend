services:
  database:
    image: 'mongo:latest'
    container_name: chromic_db
    restart: always
    environment:
      - 'MONGO_INITDB_DATABASE=chromic'
      - 'MONGO_INITDB_ROOT_PASSWORD=password'
      - 'MONGO_INITDB_ROOT_USERNAME=admin'

    ports:
      - "37017:27017"
    volumes:
      - ./mongodb/initdb.d/mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js:ro
      - mongodb-data:/data/db/
      - mongodb-log:/var/log/mongodb/
    networks:
      - chromic_net

  database_client:
      image: 'mongo-express:latest'
      container_name: chromic_db_client
      restart: always
      ports:
        - "8081:8081"
      environment:
        ME_CONFIG_MONGODB_URL: mongodb://admin:password@chromic_db:27017/chromic?authSource=admin
        ME_CONFIG_MONGODB_ENABLE_ADMIN: true
        ME_CONFIG_MONGODB_ADMINUSERNAME: admin
        ME_CONFIG_MONGODB_ADMINPASSWORD: password
        ME_CONFIG_BASICAUTH_USERNAME: admin
        ME_CONFIG_BASICAUTH_PASSWORD: password

      depends_on:
        - database
      networks:
        - chromic_net

volumes:
  mongodb-data:
      driver: local
      name: mongo-data
  mongodb-log:
      driver: local
      name: mongo-log

networks:
  chromic_net:
    driver: bridge